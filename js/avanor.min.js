!function(a){a.avanor={}}(window),function(a){a.avanor.AssetManager=function(a){var b=this,c=["n","s","e","w","ne","se","nw","sw"];a||console.info("AssetManager : Nothing to load"),b.numAssets=0,b.loadedAssets=0,b.assets={chars:{},buildings:{},terrain:{}};for(var d in a.chars)for(j in a.chars[d])b.numAssets+=8*a.chars[d][j];b.numAssets+=a.buildings.length,b.load=function(){for(var d in a.chars){var e=0;b.assets.chars[d]={};for(j in a.chars[d]){b.assets.chars[d][j]={};for(var f=0;f<c.length;f++)for(b.assets.chars[d][j][c[f]]=[],e=0;e<a.chars[d][j];e++){var g=new Image;g.src="assets/"+d+"/"+j+" "+c[f]+(10>e?"000":"00")+e+".png",b.assets.chars[d][j][c[f]][e]=g,g.addEventListener("load",function(){b.loadedAssets++})}}}for(var d=0;d<a.buildings.length;d++){var g=new Image;g.src="assets/"+a.buildings[d]+"/"+"sheet.png",b.assets.buildings[a.buildings[d]]=g,g.addEventListener("load",function(){b.loadedAssets++})}}}}(window),function(a){a.avanor.Game=function(b,c){var d=this,e=b.width,f=b.height;a.avanor.screen={},a.avanor.screen.width=e,a.avanor.screen.height=e,d.events={click:function(){},tileClick:function(){},tileHover:function(){}},d.on=function(a,b){d.events[a]=b},d.entityList=[],d.entities={},c.fillRect(0,0,e,f),d.loadAssets=function(a){d.assetManager=new avanor.AssetManager(a)},d.camera=new avanor.Camera({scale:1,x:0,y:0,width:e,height:f}),d.createMap=function(a){var b={tileWidth:128,tileHeight:96,width:e,height:f,rows:10,cols:10,camera:d.camera};a=_.extend(b,a),d.rows=a.rows,d.cols=a.cols,d.tileWidth=a.tileWidth,d.tileHeight=a.tileHeight,d.map=new avanor.Map({tileWidth:d.tileWidth,tileHeight:d.tileHeight,width:e,height:f,rows:d.rows,cols:d.cols,camera:d.camera})},d.add=function(a,b){if("undefined"!=typeof d.entities[a])throw"Object with id ["+a+"] already exists";d.entities[a]=b,d.entityList.push(b)},d.depthSort=function(){d.entityList.sort(function(a,b){return a.centeroidY>b.centeroidY})};var g=Date.now(),h=!0;d.setMapRedraw=function(a){h=a},d.draw=function(){if($("#ccan")[0].getContext("2d"),h){var a=$("#mapCanvas")[0].getContext("2d");a.fillRect(0,0,e,f),d.map.draw(a),h=!1}d.depthSort(),c.save(),c.clearRect(0,0,e,f);for(var b=0;b<d.entityList.length;b++)d.entityList[b].draw(c);c.restore();var i=Date.now(),j=Math.floor(1e3/(i-g));d.fps=j,g=i,c.fillStyle="#0f0",c.font="20px Arial",c.fillText(j+" FPS",20,20),c.fillStyle="#000"},d.run=function(){function b(){setTimeout(function(){requestAnimFrame(b),d.draw()},1e3/45)}function c(a,b){i.css({display:"block",left:e/2-200,top:f/2-50}),j.html(a),k.css("width",4*b+"px")}function g(){i.css("display","none")}a.requestAnimFrame=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)}}(),d.assetManager.load();var i=$("<div/>").addClass("loading"),j=$("<div/>").addClass("loading-text"),k=$("<div/>").addClass("loading-bar");i.append(j).append(k),$("body").append(i);var l=setInterval(function(){var a=Math.floor(100*(d.assetManager.loadedAssets/d.assetManager.numAssets));c("Loading...  "+a+"%",a),d.assetManager.loadedAssets===d.assetManager.numAssets&&(clearInterval(l),setTimeout(function(){g(),b()},1e3))},1);$(".plus").on("click",function(){d.camera.scale<=1.75&&(d.camera.scale+=.25,h=!0)}),$(".minus").on("click",function(){d.camera.scale>=.75&&(d.camera.scale-=.25,h=!0)}),$("#canvas").on("mousedown",function(a){d.map.mousedown(a),d.mouseDown=!0}),$("#canvas").on("mousemove",function(a){d.map.mousemove(a);var b=a.clientX-d.camera.x,c=a.clientY-d.camera.y,f=d.tileWidth*d.camera.scale,g=d.tileHeight*d.camera.scale;b-=e/2-f/2,col=Math.floor((b/(f/2)+c/(g/2))/2-.5),row=Math.floor((c/(g/2)-b/(f/2))/2+.5),d.events.tileHover(row,col,a.clientX,a.clientY),d.mouseDown&&(h=!0,d.moved=!0)}),$("#canvas").on("mouseup",function(a){d.map.mouseup(a),d.mouseDown=!1}),$("#canvas").on("click",function(a){if(d.moved)return d.moved=!1,void 0;var b=a.clientX-d.camera.x,c=a.clientY-d.camera.y,f=d.tileWidth*d.camera.scale,g=d.tileHeight*d.camera.scale;b-=e/2-f/2,col=Math.floor((b/(f/2)+c/(g/2))/2-.5),row=Math.floor((c/(g/2)-b/(f/2))/2+.5),d.events.click(a.clientX,a.clientY),d.events.tileClick(row,col,a.clientX,a.clientY)})},d.pathFind=function(a,b,c,e){c>=d.rows||e>=d.cols;var f=new PF.Grid(d.rows,d.cols,d.map.collisionMap),g=new PF.AStarFinder({allowDiagonal:!0,heuristic:PF.Heuristic.euclidean});return g.findPath(charRow,charCol,c,e,f)}}}(window),function(a){a.avanor.Character=function(a){var b=this;b.type="char",b.sprite=a.sprite,b.x=a.x||0,b.y=a.y||0,b.game=a.game;var c=a.character_constants;b.widthScale=c.widthScale,b.heightScale=c.heightScale,b.camera=a.camera,b.facing=a.facing||"se",b.state=a.state||"talking",b.animSpeeds=c.animSpeeds,b.destX=0,b.destY=0;var d=a.assetManager;b.charBaseX=c.baseX,b.charBaseY=c.baseY,b.animStep=0,b.oldCameraScale=b.camera.scale,b.tileWidth=a.tileWidth,b.tileHeight=a.tileHeight,b.onFinishWalking=null,b.onFinishRunning=null,b.moveX=a.moveX,b.moveY=a.moveY,b.update=function(){if(b.oldCameraScale!==b.camera.scale){avanor.Utils.mapCoordsToScreen(2,0,b.tileWidth*b.camera.scale,b.tileHeight*b.camera.scale);var a=(avanor.screen.width/2-b.x)/b.oldCameraScale/4,c=b.y/b.oldCameraScale/4;if(b.x-=b.oldCameraScale<b.camera.scale?a:-a,b.y+=b.oldCameraScale<b.camera.scale?c:-c,"running"===b.state||"walking"===b.state){for(var d=b.pathCount;d<b.path.length;d++){var e=(avanor.screen.width/2-b.path[d][0])/b.oldCameraScale/4,f=b.path[d][1]/b.oldCameraScale/4;b.path[d][0]-=b.oldCameraScale<b.camera.scale?e:-e,b.path[d][1]+=b.oldCameraScale<b.camera.scale?f:-f}var g="running"===b.state?b.moveX:b.moveX/2,h="running"===b.state?b.moveY:b.moveY/2;g*=b.camera.scale,h*=b.camera.scale,b.xd=b.x<b.path[b.pathCount][0]?g:-g,b.yd=b.y<b.path[b.pathCount][1]?h:-h,b.x===b.path[b.pathCount][0]&&(b.xd=0,b.yd=b.yd<0?-g:g),b.y===b.path[b.pathCount][1]&&(b.yd=0)}b.oldCameraScale=b.camera.scale}if("running"===b.state||"walking"===b.state)if(b.pathCount<b.path.length){var i=b.path[b.pathCount];if(b.x===i[0]&&b.y===i[1]){if(b.pathCount++,b.pathCount<b.path.length){i=b.path[b.pathCount];var g="running"===b.state?b.moveX:b.moveX/2,h="running"===b.state?b.moveY:b.moveY/2;g*=b.camera.scale,h*=b.camera.scale,b.xd=b.x<b.path[b.pathCount][0]?g:-g,b.yd=b.y<b.path[b.pathCount][1]?h:-h,b.x===b.path[b.pathCount][0]&&(b.xd=0,b.yd=b.yd<0?-g:g),b.y===b.path[b.pathCount][1]&&(b.yd=0),b.checkDir()}}else b.x+=b.xd,b.y+=b.yd}else{var j=b.state;b.state="talking","walking"===j?b.onFinishWalking&&(b.onFinishWalking(),b.onFinishWalking=null):"running"===j&&b.onFinishRunning&&(b.onFinishRunning(),b.onFinishRunning=null)}},b.draw=function(a,c){var e=b.camera;c&&(b.camera=c),b.centeroidX=b.x,b.centeroidY=b.y,b.update(),b.animStep+=b.animSpeeds[b.state],b.animStep>=d.assets.chars[b.sprite][b.state][b.facing].length&&(b.animStep=0);var f=d.assets.chars[b.sprite][b.state][b.facing][parseInt(b.animStep)],g=b.x+b.camera.x-b.charBaseX[b.state]*b.camera.scale,h=b.y+b.camera.y-b.charBaseY[b.state]*b.camera.scale,i=f.width*b.widthScale,j=f.height*b.heightScale;a.drawImage(f,g,h,i*b.camera.scale,j*b.camera.scale),avanor.debugMode&&(b.x*b.camera.scale,b.y*b.camera.scale,a.save(),a.strokeStyle="#fff",a.strokeRect(b.x+b.camera.x,b.y+b.camera.y,f.width,f.height),a.restore()),b.camera=e},b.getMapCoord=function(){var a=b.tileWidth*b.camera.scale,c=b.tileHeight*b.camera.scale,d=b.x-(avanor.screen.width/2-a/2),e=b.y;return charCol=Math.floor((d/(a/2)+e/(c/2))/2-.5),charRow=Math.floor((e/(c/2)-d/(a/2))/2+.5),{row:charRow,col:charCol}},b.checkDir=function(){var a="running"===b.state?b.moveX:b.moveX/2,c="running"===b.state?b.moveY:b.moveY/2;a*=b.camera.scale,c*=b.camera.scale,b.xd===a&&b.yd===c?b.facing="se":b.xd===a&&b.yd===-c?b.facing="ne":b.xd===-a&&b.yd===-c?b.facing="nw":b.xd===-a&&b.yd===c?b.facing="sw":0===b.xd&&b.yd<0?b.facing="n":0===b.xd&&b.yd>0?b.facing="s":b.xd>0&&0===b.yd?b.facing="e":b.xd<0&&0===b.yd&&(b.facing="w")},b.runTo=function(a,c,d){var e=b.game.pathFind(b.getMapCoord().row,b.getMapCoord().col,a,c);0!==e.length&&(e=b.pathMapToScreenCoords(e),b.state="running",b.pathCount=1,b.path=e,b.onFinishRunning=d,b.xd=b.x<e[1][0]?b.moveX*b.camera.scale:-b.moveX*b.camera.scale,b.yd=b.y<e[1][1]?b.moveY*b.camera.scale:-b.moveY*b.camera.scale,b.x===e[1][0]&&(b.xd=0),b.y===e[1][1]&&(b.yd=0),b.oldCameraX=b.camera.x,b.oldCameraY=b.camera.y,b.oldCameraScale=b.camera.scale,b.checkDir())},b.pathMapToScreenCoords=function(a){for(var c=[],d=b.tileWidth*b.camera.scale,e=b.tileHeight*b.camera.scale,f=0;f<a.length;f++){c[f]=[];var g=avanor.Utils.mapCoordsToScreen(a[f][0],a[f][1],d,e);c[f][0]=g.x+d/2,c[f][1]=g.y+e/2}return c},b.walkTo=function(a,c,d){var e=b.game.pathFind(b.getMapCoord().row,b.getMapCoord().col,a,c);0!==e.length&&(e=b.pathMapToScreenCoords(e),b.state="walking",b.pathCount=1,b.path=e,b.onFinishWalking=d,b.xd=b.x<e[1][0]?b.moveX/2*b.camera.scale:-b.moveX/2*b.camera.scale,b.yd=b.y<e[1][1]?b.moveY/2*b.camera.scale:-b.moveY/2*b.camera.scale,b.x===e[1][0]&&(b.xd=0),b.y===e[1][1]&&(b.yd=0),b.oldCameraX=b.camera.x,b.oldCameraY=b.camera.y,b.oldCameraScale=b.camera.scale,b.checkDir())}}}(window),function(a){a.avanor.character_constants={"char":{animSpeeds:{talking:.2,walking:.4,running:.4},baseX:{talking:48,walking:48,running:48},baseY:{talking:72,walking:72,running:72},widthScale:1,heightScale:1},arno:{animSpeeds:{talking:.2,walking:.4,running:.4},baseX:{talking:48,walking:48,running:48},baseY:{talking:64,walking:64,running:64},widthScale:1,heightScale:1},horst:{animSpeeds:{talking:.2,walking:.4,running:.4},baseX:{talking:48,walking:48,running:64},baseY:{talking:64,walking:64,running:84},widthScale:1,heightScale:1}}}(window),function(a){a.avanor.Camera=function(a){var b=this;b.scale=a.scale,b.x=a.x,b.y=a.y,b.width=a.width,b.height=a.height,b.panLeft=function(a){a?b.x+=a:b.x++},b.panRight=function(a){a?b.x-=a:b.x--},b.panUp=function(a){a?b.y+=a:b.y++},b.panDown=function(a){a?b.y-=a:b.y--}}}(window),function(a){a.avanor.Building=function(a){var b=this;b.type="building",b.mapPosX=a.mapPosX,b.mapPosY=a.mapPosY,b.mapWidth=avanor.building_constants[a.sprite].mapWidth,b.mapHeight=avanor.building_constants[a.sprite].mapHeight,b.spriteSheet=a.spriteSheet,b.sprite=a.sprite,b.xOffset=avanor.building_constants[a.sprite].xOffset,b.yOffset=avanor.building_constants[a.sprite].yOffset,b.baseX=avanor.building_constants[a.sprite].baseX,b.baseY=avanor.building_constants[a.sprite].baseY,b.tileWidth=a.tileWidth,b.tileHeight=a.tileHeight;var c=a.camera,d=a.assetManager;b.pos=avanor.Utils.mapCoordsToScreen(b.mapPosX,b.mapPosY,b.tileWidth*c.scale,b.tileHeight*c.scale),console.log(b.mapPosX,b.mapPosY),b.centeroidX=b.pos.x+b.tileWidth/2,b.centeroidY=b.pos.y+b.tileHeight/2;for(var e=[],f=avanor.building_constants[a.sprite].occupies,g=b.mapPosX;g<b.mapPosX+f[0];g++)for(var h=b.mapPosY;h<b.mapPosY+f[1];h++)e.push([g,h]);a.map.addSolidObject(e),b.renderOpacity=1,b.draw=function(a){var e=d.assets.buildings[b.spriteSheet];b.pos=avanor.Utils.mapCoordsToScreen(b.mapPosX,b.mapPosY,b.tileWidth*c.scale,b.tileHeight*c.scale),b.centeroidX=b.pos.x+b.tileWidth/2*f[0]*c.scale,b.centeroidY=b.pos.y+b.tileHeight/2*f[1]*c.scale,a.save(),a.globalAlpha=b.renderOpacity,a.drawImage(e,b.xOffset,b.yOffset,256,256,b.pos.x+b.baseX*c.scale+c.x,b.pos.y+b.baseY*c.scale+c.y,b.mapWidth*c.scale,b.mapHeight*c.scale),a.restore(),avanor.debugMode&&(a.save(),a.strokeStyle="#fff",a.strokeRect(b.pos.x+c.x,b.pos.y+c.y,b.mapWidth,b.mapHeight),a.restore())}}}(window),function(a){a.avanor.building_constants={stone_hut_sw:{mapWidth:256,mapHeight:256,xOffset:0,yOffset:30,baseX:-96,baseY:-64,occupies:[4,4]},stone_hut_se:{mapWidth:256,mapHeight:256,xOffset:512,yOffset:30,baseX:-96,baseY:-64,occupies:[4,4]},stone_hut_ne:{mapWidth:256,mapHeight:256,xOffset:256,yOffset:30,baseX:-96,baseY:-64,occupies:[4,4]},stone_hut_nw:{mapWidth:256,mapHeight:256,xOffset:768,yOffset:30,baseX:-96,baseY:-64,occupies:[4,4]}}}(window),function(a){a.avanor.Map=function(a){function b(a){this.level=a.level,this.type=a.type}var c=this,d=a.width,e=(a.height,a.tileWidth),f=a.tileHeight,g=a.rows,h=a.cols,i=[];c.collisionMap=[];var j=[];c.camera=a.camera;var k=c.camera,l=e*k.scale,m=f*k.scale,n=[Math.random(),Math.random(),Math.random(),Math.random()];console.log(n);for(var o=2,p=0;g>p;p++){for(var q=[],r=[],s=0;h>s;s++){var t;if(o>p||p>g-1-o||o>s||s>h-1-o)t="wa.fl";else{noise.seed(n[0]),t=noise.simplex2(p/20,s/20),noise.seed(n[1]),t+=noise.simplex2(p/20,s/20),noise.seed(n[2]),t+=noise.simplex2(p/20,s/20),noise.seed(n[3]),t+=noise.simplex2(p/20,s/20);var u=0,v=0;u=g/2>p?p:g-p,v=h/2>s?s:h-s;var w=u/(g/2);w+=v/(g/2),t=t>w?"wa.fl":"re.fl"}q.push(new b({level:0,type:t})),r.push(0)}i.push(q),c.collisionMap.push(r)}for(var p=0;g>p;p++)for(var s=0;h>s;s++)if("wa.fl"!==i[p][s].type){if(p>0){if(s>0){if("wa.fl"===i[p-1][s].type&&"wa.fl"===i[p][s-1].type&&"wa.fl"===i[p-1][s-1].type){i[p][s].type="wa.mask.nwf.re";continue}if("wa.fl"===i[p-1][s].type&&"wa.fl"===i[p][s+1].type&&"wa.fl"===i[p-1][s+1].type){i[p][s].type="wa.mask.nef.re";continue}if("wa.fl"!==i[p-1][s].type&&"wa.fl"!==i[p][s+1].type&&"wa.fl"===i[p-1][s+1].type){i[p][s].type="wa.mask.swi.re";continue}if("wa.fl"!==i[p-1][s].type&&"wa.fl"!==i[p][s-1].type&&"wa.fl"===i[p-1][s-1].type){i[p][s].type="wa.mask.sei.re";continue}}if("wa.fl"===i[p-1][s].type){var x="s";1==Math.floor(2*Math.random())&&(x="b"),i[p][s].type="wa.mask.n"+x+".re";continue}}if(g-1>p){if(h-1>s){if("wa.fl"===i[p][s-1].type&&"wa.fl"===i[p+1][s].type&&"wa.fl"===i[p+1][s-1].type){i[p][s].type="wa.mask.swf.re";continue}if("wa.fl"===i[p][s+1].type&&"wa.fl"===i[p+1][s].type&&"wa.fl"===i[p+1][s+1].type){i[p][s].type="wa.mask.sef.re";continue}if("wa.fl"!==i[p][s-1].type&&"wa.fl"!==i[p+1][s].type&&"wa.fl"===i[p+1][s-1].type){i[p][s].type="wa.mask.nei.re";continue}if("wa.fl"!==i[p][s+1].type&&"wa.fl"!==i[p+1][s].type&&"wa.fl"===i[p+1][s+1].type){i[p][s].type="wa.mask.nwi.re";continue}}if("wa.fl"===i[p+1][s].type){var x="s";1==Math.floor(2*Math.random())&&(x="b"),i[p][s].type="wa.mask.s"+x+".re";continue}}if(s>0&&"wa.fl"===i[p][s-1].type){var x="s";1==Math.floor(2*Math.random())&&(console.log(Math.floor(2*Math.random())),x="b"),i[p][s].type="wa.mask.w"+x+".re";continue}if(h-1>s&&"wa.fl"===i[p][s+1].type){var x="s";1==Math.floor(2*Math.random())&&(x="b"),i[p][s].type="wa.mask.e"+x+".re";continue}}for(var p=0;g>p;p++)for(var s=0;h>s;s++)"re.fl"!==i[p][s].type&&(c.collisionMap[p][s]=1);c.imgs={re:new Image,gr:new Image,gr_t:new Image,wa:new Image,wa_mask:new Image},c.imgs.re.src="re.png",c.imgs.gr.src="gr.png",c.imgs.wa.src="wa.png",c.imgs.gr_t.src="gr_tileset.png",c.imgs.wa_mask.src="wa_mask.png",c.drawTerrain=function(a,b,d,g,h){var i=a.type.split("."),j=a.level,k=i[0],l=i[1],m="fl"===l?c.imgs[k]:c.imgs[k+"_t"],n="",o=null;if("fl"===l)m=c.imgs[k],o=avanor.terrain_constants[k][l],g.drawImage(m,o.xOffset,o.yOffset,o.width,o.height,b,d,e*h.scale,f*h.scale);else if("mask"===l)m=c.imgs[k+"_mask"],img1=c.imgs.re,n=i[2],i[3],o=avanor.terrain_constants.re.fl,g.save(),g.drawImage(img1,o.xOffset,o.yOffset,o.width,o.height,b,d,e*h.scale,f*h.scale),o=avanor.terrain_constants[k][l][n],g.drawImage(m,o.xOffset,o.yOffset,o.width,o.height,b,d,e*h.scale,f*h.scale),g.restore();else{switch(m=c.imgs[k+"_t"],o=avanor.terrain_constants[k][l],l){case"unw":case"une":case"use":case"usw":g.drawImage(c.imgs.gr,b,d-25*j)}g.drawImage(m,o.xOffset,o.yOffset,o.width,o.height,b+o.mapOffsetX,d+o.mapOffsetY-25*j,e*h.scale,f*h.scale)}},c.drawHighlights=function(a){for(var b=0;b<j.length;b++){var d=avanor.Utils.mapCoordsToScreen(j[b].row,j[b].col,e*c.camera.scale,f*c.camera.scale),g=d.x+c.camera.x,h=d.y+c.camera.y,i=null;j[b].darken&&(i="#000"),j[b].lighten&&(i="#fff");var k=e*c.camera.scale,l=f*c.camera.scale;i&&(a.save(),a.beginPath(),a.fillStyle=i,a.globalAlpha=.3,a.moveTo(g+k/2,h),a.lineTo(g,h+l/2),a.lineTo(g+k/2,h+l),a.lineTo(g+k,h+l/2),a.closePath(),a.fill(),a.restore()),j[b].border&&(a.save(),a.beginPath(),a.strokeStyle=j[b].borderColor,a.moveTo(g+k/2,h),a.lineTo(g,h+l/2),a.lineTo(g+k/2,h+l),a.lineTo(g+k,h+l/2),a.closePath(),a.stroke(),a.restore())}},c.setHighlight=function(a){c.highlight=a},c.highlightTile=function(a){j.push(a)},c.clearHighlights=function(){j=[]},c.highlightTiles=function(a){j=j.concat(a)},c.addSolidObject=function(a){for(var b=0;b<a.length;b++)c.collisionMap[a[b][1]][a[b][0]]=1},c.getScreenCoords=function(a){for(var b=[],c=0;c<a.length;c++){b[c]=[];var e=a[c][0],f=a[c][1],g=d/2-l/2+f*l/2-e*l/2,h=f*m/2+e*m/2;g+=k.x,h+=k.y;var i=g+l/2,j=h+m/2;b[c][0]=i,b[c][1]=j}return b},c.draw=function(a,b){var j=k;b&&(k=b);var l=e*k.scale,m=f*k.scale,n=-k.x,o=-k.y,p=n+avanor.screen.width,q=o+avanor.screen.height,r=avanor.Utils.screenCoordsToMap(p,o,l,m).row,s=avanor.Utils.screenCoordsToMap(n,q,l,m).row,t=avanor.Utils.screenCoordsToMap(n,o,l,m).col,u=avanor.Utils.screenCoordsToMap(p,q,l,m).col;r=0>r?0:r,t=0>t?0:t,s=s>=g?g:s,u=u>=h?h:u,console.log(r,s,t,u);for(var v=r;s>v;v++)for(var w=t;u>w;w++){var x=d/2-l/2+w*l/2-v*l/2,y=w*m/2+v*m/2;if(x+=k.x,y+=k.y,!(-l>x||x>d||-m>y||y>d)){var z=x+l/2,A=y+m/2;c.drawTerrain(i[v][w],x,y,a,k),avanor.debugMode&&(a.save(),a.beginPath(),a.strokeStyle="#fff",a.moveTo(x+l/2,y),a.lineTo(x,y+m/2),a.lineTo(x+l/2,y+m),a.lineTo(x+l,y+m/2),a.closePath(),a.stroke(),a.restore(),a.save(),a.beginPath(),a.fillStyle="#fff",a.arc(z,A,4,0,2*Math.PI),a.fill(),a.restore(),a.save(),a.fillStyle="#fff",a.font="10px Arial",a.fillText(""+v+","+w,z-8,A-8),a.restore())}}if(c.drawHighlights(a),c.highlight&&avanor.debugMode)for(var B=null,C=null,D=0;D<c.highlight.length;D++){var v=c.highlight[D][0],w=c.highlight[D][1],x=d/2-l/2+w*l/2-v*l/2,y=w*m/2+v*m/2;x+=k.x,y+=k.y;var z=x+l/2,A=y+m/2;a.save(),a.beginPath(),a.globalAlpha=.2,a.strokeStyle="#000",a.moveTo(x+l/2,y),a.lineTo(x,y+m/2),a.lineTo(x+l/2,y+m),a.lineTo(x+l,y+m/2),a.closePath(),a.fill(),a.restore(),a.save(),a.beginPath(),a.fillStyle="#000",a.arc(z,A,4,0,2*Math.PI),a.stroke(),a.fill(),a.restore(),null!==B&&null!==C&&(a.save(),a.beginPath(),a.strokeStyle="#000",a.moveTo(B,C),a.lineTo(z,A),a.stroke(),a.fill(),a.restore()),B=z,C=A}k=j};var y=!1,z=null,A=null,B=k.x,C=k.y;c.mousedown=function(a){y=!0,z=a.clientX,A=a.clientY,B=k.x,C=k.y},c.mouseup=function(){y=!1},c.mousemove=function(a){y&&(distX=a.clientX-z+B,distY=a.clientY-A+C,k.x=distX,k.y=distY)}}}(window),function(a){if("function"==typeof bootstrap)bootstrap("pf",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makePF=a}else"undefined"!=typeof window?window.PF=a():global.PF=a()}(function(){return function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({1:[function(a,b){b.exports={Node:a("./core/Node"),Grid:a("./core/Grid"),Heap:a("./core/Heap"),Util:a("./core/Util"),Heuristic:a("./core/Heuristic"),AStarFinder:a("./finders/AStarFinder"),BestFirstFinder:a("./finders/BestFirstFinder"),BreadthFirstFinder:a("./finders/BreadthFirstFinder"),DijkstraFinder:a("./finders/DijkstraFinder"),BiAStarFinder:a("./finders/BiAStarFinder"),BiBestFirstFinder:a("./finders/BiBestFirstFinder"),BiBreadthFirstFinder:a("./finders/BiBreadthFirstFinder"),BiDijkstraFinder:a("./finders/BiDijkstraFinder"),JumpPointFinder:a("./finders/JumpPointFinder")}},{"./core/Grid":2,"./core/Heap":3,"./core/Heuristic":4,"./core/Node":5,"./core/Util":6,"./finders/AStarFinder":7,"./finders/BestFirstFinder":8,"./finders/BiAStarFinder":9,"./finders/BiBestFirstFinder":10,"./finders/BiBreadthFirstFinder":11,"./finders/BiDijkstraFinder":12,"./finders/BreadthFirstFinder":13,"./finders/DijkstraFinder":14,"./finders/JumpPointFinder":15}],2:[function(a,b){function c(a,b,c){this.width=a,this.height=b,this.nodes=this._buildNodes(a,b,c)}var d=a("./Node");c.prototype._buildNodes=function(a,b,c){var e,f,g=new Array(b);for(e=0;b>e;++e)for(g[e]=new Array(a),f=0;a>f;++f)g[e][f]=new d(f,e);if(void 0===c)return g;if(c.length!==b||c[0].length!==a)throw new Error("Matrix size does not fit");for(e=0;b>e;++e)for(f=0;a>f;++f)c[e][f]&&(g[e][f].walkable=!1);return g},c.prototype.getNodeAt=function(a,b){return this.nodes[b][a]},c.prototype.isWalkableAt=function(a,b){return this.isInside(a,b)&&this.nodes[b][a].walkable},c.prototype.isInside=function(a,b){return a>=0&&a<this.width&&b>=0&&b<this.height},c.prototype.setWalkableAt=function(a,b,c){this.nodes[b][a].walkable=c},c.prototype.getNeighbors=function(a,b,c){var d=a.x,e=a.y,f=[],g=!1,h=!1,i=!1,j=!1,k=!1,l=!1,m=!1,n=!1,o=this.nodes;return this.isWalkableAt(d,e-1)&&(f.push(o[e-1][d]),g=!0),this.isWalkableAt(d+1,e)&&(f.push(o[e][d+1]),i=!0),this.isWalkableAt(d,e+1)&&(f.push(o[e+1][d]),k=!0),this.isWalkableAt(d-1,e)&&(f.push(o[e][d-1]),m=!0),b?(c?(h=m&&g,j=g&&i,l=i&&k,n=k&&m):(h=m||g,j=g||i,l=i||k,n=k||m),h&&this.isWalkableAt(d-1,e-1)&&f.push(o[e-1][d-1]),j&&this.isWalkableAt(d+1,e-1)&&f.push(o[e-1][d+1]),l&&this.isWalkableAt(d+1,e+1)&&f.push(o[e+1][d+1]),n&&this.isWalkableAt(d-1,e+1)&&f.push(o[e+1][d-1]),f):f},c.prototype.clone=function(){var a,b,e=this.width,f=this.height,g=this.nodes,h=new c(e,f),i=new Array(f);for(a=0;f>a;++a)for(i[a]=new Array(e),b=0;e>b;++b)i[a][b]=new d(b,a,g[a][b].walkable);return h.nodes=i,h},b.exports=c},{"./Node":5}],3:[function(a,b){(function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o,p;d=Math.floor,k=Math.min,c=function(a,b){return b>a?-1:a>b?1:0},j=function(a,b,e,f,g){var h;if(null==e&&(e=0),null==g&&(g=c),0>e)throw new Error("lo must be non-negative");for(null==f&&(f=a.length);g(e,f)<0;)h=d((e+f)/2),g(b,a[h])<0?f=h:e=h+1;return[].splice.apply(a,[e,e-e].concat(b)),b},g=function(a,b,d){return null==d&&(d=c),a.push(b),o(a,0,a.length-1,d)},f=function(a,b){var d,e;return null==b&&(b=c),d=a.pop(),a.length?(e=a[0],a[0]=d,p(a,0,b)):e=d,e},i=function(a,b,d){var e;return null==d&&(d=c),e=a[0],a[0]=b,p(a,0,d),e},h=function(a,b,d){var e;return null==d&&(d=c),a.length&&d(a[0],b)<0&&(e=[a[0],b],b=e[0],a[0]=e[1],p(a,0,d)),b},e=function(a,b){var e,f,g,h,i,j;for(null==b&&(b=c),h=function(){j=[];for(var b=0,c=d(a.length/2);c>=0?c>b:b>c;c>=0?b++:b--)j.push(b);return j}.apply(this).reverse(),i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(p(a,e,b));return i},n=function(a,b,d){var e;return null==d&&(d=c),e=a.indexOf(b),o(a,0,e,d),p(a,e,d)},l=function(a,b,d){var f,g,i,j,k;if(null==d&&(d=c),g=a.slice(0,b),!g.length)return g;for(e(g,d),k=a.slice(b),i=0,j=k.length;j>i;i++)f=k[i],h(g,f,d);return g.sort(d).reverse()},m=function(a,b,d){var g,h,i,l,m,n,o,p,q,r;if(null==d&&(d=c),10*b<=a.length){if(l=a.slice(0,b).sort(d),!l.length)return l;for(i=l[l.length-1],p=a.slice(b),m=0,o=p.length;o>m;m++)g=p[m],d(g,i)<0&&(j(l,g,0,null,d),l.pop(),i=l[l.length-1]);return l}for(e(a,d),r=[],h=n=0,q=k(b,a.length);q>=0?q>n:n>q;h=q>=0?++n:--n)r.push(f(a,d));return r},o=function(a,b,d,e){var f,g,h;for(null==e&&(e=c),f=a[d];d>b&&(h=d-1>>1,g=a[h],e(f,g)<0);)a[d]=g,d=h;return a[d]=f},p=function(a,b,d){var e,f,g,h,i;for(null==d&&(d=c),f=a.length,i=b,g=a[b],e=2*b+1;f>e;)h=e+1,f>h&&!(d(a[e],a[h])<0)&&(e=h),a[b]=a[e],b=e,e=2*b+1;return a[b]=g,o(a,i,b,d)},a=function(){function a(a){this.cmp=null!=a?a:c,this.nodes=[]}return a.name="Heap",a.push=g,a.pop=f,a.replace=i,a.pushpop=h,a.heapify=e,a.nlargest=l,a.nsmallest=m,a.prototype.push=function(a){return g(this.nodes,a,this.cmp)},a.prototype.pop=function(){return f(this.nodes,this.cmp)},a.prototype.peek=function(){return this.nodes[0]},a.prototype.contains=function(a){return-1!==this.nodes.indexOf(a)},a.prototype.replace=function(a){return i(this.nodes,a,this.cmp)},a.prototype.pushpop=function(a){return h(this.nodes,a,this.cmp)},a.prototype.heapify=function(){return e(this.nodes,this.cmp)},a.prototype.updateItem=function(a){return n(this.nodes,a,this.cmp)},a.prototype.clear=function(){return this.nodes=[]},a.prototype.empty=function(){return 0===this.nodes.length},a.prototype.size=function(){return this.nodes.length},a.prototype.clone=function(){var b;return b=new a,b.nodes=this.nodes.slice(0),b},a.prototype.toArray=function(){return this.nodes.slice(0)},a.prototype.insert=a.prototype.push,a.prototype.remove=a.prototype.pop,a.prototype.top=a.prototype.peek,a.prototype.front=a.prototype.peek,a.prototype.has=a.prototype.contains,a.prototype.copy=a.prototype.clone,a}(),("undefined"!=typeof b&&null!==b?b.exports:void 0)?b.exports=a:window.Heap=a}).call(this)},{}],4:[function(a,b){b.exports={manhattan:function(a,b){return a+b},euclidean:function(a,b){return Math.sqrt(a*a+b*b)},chebyshev:function(a,b){return Math.max(a,b)}}},{}],5:[function(a,b){function c(a,b,c){this.x=a,this.y=b,this.walkable=void 0===c?!0:c}b.exports=c},{}],6:[function(a,b,c){function d(a){for(var b=[[a.x,a.y]];a.parent;)a=a.parent,b.push([a.x,a.y]);return b.reverse()}function e(a,b){var c=d(a),e=d(b);return c.concat(e.reverse())}function f(a){var b,c,d,e,f,g=0;for(b=1;b<a.length;++b)c=a[b-1],d=a[b],e=c[0]-d[0],f=c[1]-d[1],g+=Math.sqrt(e*e+f*f);return g}function g(a,b,c,d){var e,f,g,h,i,j,k=Math.abs,l=[];for(g=k(c-a),h=k(d-b),e=c>a?1:-1,f=d>b?1:-1,i=g-h;;){if(l.push([a,b]),a===c&&b===d)break;j=2*i,j>-h&&(i-=h,a+=e),g>j&&(i+=g,b+=f)}return l}function h(a,b){var c,d,e,f,h,i,j,k,l,m,n,o,p,q=b.length,r=b[0][0],s=b[0][1],t=b[q-1][0],u=b[q-1][1];for(c=r,d=s,h=b[1][0],i=b[1][1],j=[[c,d]],k=2;q>k;++k){for(m=b[k],e=m[0],f=m[1],n=g(c,d,e,f),p=!1,l=1;l<n.length;++l)if(o=n[l],!a.isWalkableAt(o[0],o[1])){p=!0,j.push([h,i]),c=h,d=i;break}p||(h=e,i=f)}return j.push([t,u]),j}c.backtrace=d,c.biBacktrace=e,c.pathLength=f,c.getLine=g,c.smoothenPath=h},{}],7:[function(a,b){function c(a){a=a||{},this.allowDiagonal=a.allowDiagonal,this.dontCrossCorners=a.dontCrossCorners,this.heuristic=a.heuristic||f.manhattan,this.weight=a.weight||1}var d=a("../core/Heap"),e=a("../core/Util"),f=a("../core/Heuristic");c.prototype.findPath=function(a,b,c,f,g){var h,i,j,k,l,m,n,o,p=new d(function(a,b){return a.f-b.f}),q=g.getNodeAt(a,b),r=g.getNodeAt(c,f),s=this.heuristic,t=this.allowDiagonal,u=this.dontCrossCorners,v=this.weight,w=Math.abs,x=Math.SQRT2;for(q.g=0,q.f=0,p.push(q),q.opened=!0;!p.empty();){if(h=p.pop(),h.closed=!0,h===r)return e.backtrace(r);for(i=g.getNeighbors(h,t,u),k=0,l=i.length;l>k;++k)j=i[k],j.closed||(m=j.x,n=j.y,o=h.g+(0===m-h.x||0===n-h.y?1:x),(!j.opened||o<j.g)&&(j.g=o,j.h=j.h||v*s(w(m-c),w(n-f)),j.f=j.g+j.h,j.parent=h,j.opened?p.updateItem(j):(p.push(j),j.opened=!0)))}return[]},b.exports=c},{"../core/Heap":3,"../core/Heuristic":4,"../core/Util":6}],8:[function(a,b){function c(a){d.call(this,a);var b=this.heuristic;this.heuristic=function(a,c){return 1e6*b(a,c)}}var d=a("./AStarFinder");c.prototype=new d,c.prototype.constructor=c,b.exports=c},{"./AStarFinder":7}],9:[function(a,b){function c(a){a=a||{},this.allowDiagonal=a.allowDiagonal,this.dontCrossCorners=a.dontCrossCorners,this.heuristic=a.heuristic||f.manhattan,this.weight=a.weight||1}var d=a("../core/Heap"),e=a("../core/Util"),f=a("../core/Heuristic");c.prototype.findPath=function(a,b,c,f,g){var h,i,j,k,l,m,n,o,p=function(a,b){return a.f-b.f},q=new d(p),r=new d(p),s=g.getNodeAt(a,b),t=g.getNodeAt(c,f),u=this.heuristic,v=this.allowDiagonal,w=this.dontCrossCorners,x=this.weight,y=Math.abs,z=Math.SQRT2,A=1,B=2;for(s.g=0,s.f=0,q.push(s),s.opened=A,t.g=0,t.f=0,r.push(t),t.opened=B;!q.empty()&&!r.empty();){for(h=q.pop(),h.closed=!0,i=g.getNeighbors(h,v,w),k=0,l=i.length;l>k;++k)if(j=i[k],!j.closed){if(j.opened===B)return e.biBacktrace(h,j);m=j.x,n=j.y,o=h.g+(0===m-h.x||0===n-h.y?1:z),(!j.opened||o<j.g)&&(j.g=o,j.h=j.h||x*u(y(m-c),y(n-f)),j.f=j.g+j.h,j.parent=h,j.opened?q.updateItem(j):(q.push(j),j.opened=A))}for(h=r.pop(),h.closed=!0,i=g.getNeighbors(h,v,w),k=0,l=i.length;l>k;++k)if(j=i[k],!j.closed){if(j.opened===A)return e.biBacktrace(j,h);m=j.x,n=j.y,o=h.g+(0===m-h.x||0===n-h.y?1:z),(!j.opened||o<j.g)&&(j.g=o,j.h=j.h||x*u(y(m-a),y(n-b)),j.f=j.g+j.h,j.parent=h,j.opened?r.updateItem(j):(r.push(j),j.opened=B))}}return[]},b.exports=c},{"../core/Heap":3,"../core/Heuristic":4,"../core/Util":6}],10:[function(a,b){function c(a){d.call(this,a);var b=this.heuristic;this.heuristic=function(a,c){return 1e6*b(a,c)}}var d=a("./BiAStarFinder");c.prototype=new d,c.prototype.constructor=c,b.exports=c},{"./BiAStarFinder":9}],11:[function(a,b){function c(a){a=a||{},this.allowDiagonal=a.allowDiagonal,this.dontCrossCorners=a.dontCrossCorners}var d=a("../core/Util");c.prototype.findPath=function(a,b,c,e,f){var g,h,i,j,k,l=f.getNodeAt(a,b),m=f.getNodeAt(c,e),n=[],o=[],p=this.allowDiagonal,q=this.dontCrossCorners,r=0,s=1;for(n.push(l),l.opened=!0,l.by=r,o.push(m),m.opened=!0,m.by=s;n.length&&o.length;){for(i=n.shift(),i.closed=!0,g=f.getNeighbors(i,p,q),j=0,k=g.length;k>j;++j)if(h=g[j],!h.closed)if(h.opened){if(h.by===s)return d.biBacktrace(i,h)}else n.push(h),h.parent=i,h.opened=!0,h.by=r;for(i=o.shift(),i.closed=!0,g=f.getNeighbors(i,p,q),j=0,k=g.length;k>j;++j)if(h=g[j],!h.closed)if(h.opened){if(h.by===r)return d.biBacktrace(h,i)}else o.push(h),h.parent=i,h.opened=!0,h.by=s}return[]},b.exports=c},{"../core/Util":6}],12:[function(a,b){function c(a){d.call(this,a),this.heuristic=function(){return 0}}var d=a("./BiAStarFinder");c.prototype=new d,c.prototype.constructor=c,b.exports=c},{"./BiAStarFinder":9}],13:[function(a,b){function c(a){a=a||{},this.allowDiagonal=a.allowDiagonal,this.dontCrossCorners=a.dontCrossCorners}var d=a("../core/Util");c.prototype.findPath=function(a,b,c,e,f){var g,h,i,j,k,l=[],m=this.allowDiagonal,n=this.dontCrossCorners,o=f.getNodeAt(a,b),p=f.getNodeAt(c,e);for(l.push(o),o.opened=!0;l.length;){if(i=l.shift(),i.closed=!0,i===p)return d.backtrace(p);for(g=f.getNeighbors(i,m,n),j=0,k=g.length;k>j;++j)h=g[j],h.closed||h.opened||(l.push(h),h.opened=!0,h.parent=i)}return[]},b.exports=c},{"../core/Util":6}],14:[function(a,b){function c(a){d.call(this,a),this.heuristic=function(){return 0}}var d=a("./AStarFinder");c.prototype=new d,c.prototype.constructor=c,b.exports=c},{"./AStarFinder":7}],15:[function(a,b){function c(a){a=a||{},this.heuristic=a.heuristic||f.manhattan,this.trackJumpRecursion=a.trackJumpRecursion||!1}var d=a("../core/Heap"),e=a("../core/Util"),f=a("../core/Heuristic");c.prototype.findPath=function(a,b,c,f,g){var h,i=this.openList=new d(function(a,b){return a.f-b.f}),j=this.startNode=g.getNodeAt(a,b),k=this.endNode=g.getNodeAt(c,f);for(this.grid=g,j.g=0,j.f=0,i.push(j),j.opened=!0;!i.empty();){if(h=i.pop(),h.closed=!0,h===k)return e.backtrace(k);this._identifySuccessors(h)}return[]},c.prototype._identifySuccessors=function(a){var b,c,d,e,g,h,i,j,k,l,m=this.grid,n=this.heuristic,o=this.openList,p=this.endNode.x,q=this.endNode.y,r=a.x,s=a.y,t=Math.abs;for(Math.max,b=this._findNeighbors(a),e=0,g=b.length;g>e;++e)if(c=b[e],d=this._jump(c[0],c[1],r,s)){if(h=d[0],i=d[1],l=m.getNodeAt(h,i),l.closed)continue;j=f.euclidean(t(h-r),t(i-s)),k=a.g+j,(!l.opened||k<l.g)&&(l.g=k,l.h=l.h||n(t(h-p),t(i-q)),l.f=l.g+l.h,l.parent=a,l.opened?o.updateItem(l):(o.push(l),l.opened=!0))}},c.prototype._jump=function(a,b,c,d){var e,f,g=this.grid,h=a-c,i=b-d;if(!g.isWalkableAt(a,b))return null;if(this.trackJumpRecursion===!0&&(g.getNodeAt(a,b).jumptest=!0),g.getNodeAt(a,b)===this.endNode)return[a,b];if(0!==h&&0!==i){if(g.isWalkableAt(a-h,b+i)&&!g.isWalkableAt(a-h,b)||g.isWalkableAt(a+h,b-i)&&!g.isWalkableAt(a,b-i))return[a,b]}else if(0!==h){if(g.isWalkableAt(a+h,b+1)&&!g.isWalkableAt(a,b+1)||g.isWalkableAt(a+h,b-1)&&!g.isWalkableAt(a,b-1))return[a,b]}else if(g.isWalkableAt(a+1,b+i)&&!g.isWalkableAt(a+1,b)||g.isWalkableAt(a-1,b+i)&&!g.isWalkableAt(a-1,b))return[a,b];return 0!==h&&0!==i&&(e=this._jump(a+h,b,a,b),f=this._jump(a,b+i,a,b),e||f)?[a,b]:g.isWalkableAt(a+h,b)||g.isWalkableAt(a,b+i)?this._jump(a+h,b+i,a,b):null},c.prototype._findNeighbors=function(a){var b,c,d,e,f,g,h,i,j=a.parent,k=a.x,l=a.y,m=this.grid,n=[];if(j)b=j.x,c=j.y,d=(k-b)/Math.max(Math.abs(k-b),1),e=(l-c)/Math.max(Math.abs(l-c),1),0!==d&&0!==e?(m.isWalkableAt(k,l+e)&&n.push([k,l+e]),m.isWalkableAt(k+d,l)&&n.push([k+d,l]),(m.isWalkableAt(k,l+e)||m.isWalkableAt(k+d,l))&&n.push([k+d,l+e]),!m.isWalkableAt(k-d,l)&&m.isWalkableAt(k,l+e)&&n.push([k-d,l+e]),!m.isWalkableAt(k,l-e)&&m.isWalkableAt(k+d,l)&&n.push([k+d,l-e])):0===d?m.isWalkableAt(k,l+e)&&(m.isWalkableAt(k,l+e)&&n.push([k,l+e]),m.isWalkableAt(k+1,l)||n.push([k+1,l+e]),m.isWalkableAt(k-1,l)||n.push([k-1,l+e])):m.isWalkableAt(k+d,l)&&(m.isWalkableAt(k+d,l)&&n.push([k+d,l]),m.isWalkableAt(k,l+1)||n.push([k+d,l+1]),m.isWalkableAt(k,l-1)||n.push([k+d,l-1]));
else for(f=m.getNeighbors(a,!0),h=0,i=f.length;i>h;++h)g=f[h],n.push([g.x,g.y]);return n},b.exports=c},{"../core/Heap":3,"../core/Heuristic":4,"../core/Util":6}]},{},[1])(1)}),function(a){function b(a,b,c){this.x=a,this.y=b,this.z=c}function c(a){return a*a*a*(a*(6*a-15)+10)}function d(a,b,c){return(1-c)*a+c*b}var e=a.noise={};b.prototype.dot2=function(a,b){return this.x*a+this.y*b},b.prototype.dot3=function(a,b,c){return this.x*a+this.y*b+this.z*c};var f=[new b(1,1,0),new b(-1,1,0),new b(1,-1,0),new b(-1,-1,0),new b(1,0,1),new b(-1,0,1),new b(1,0,-1),new b(-1,0,-1),new b(0,1,1),new b(0,-1,1),new b(0,1,-1),new b(0,-1,-1)],g=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],h=new Array(512),i=new Array(512);e.seed=function(a){a>0&&1>a&&(a*=65536),a=Math.floor(a),256>a&&(a|=a<<8);for(var b=0;256>b;b++){var c;c=1&b?g[b]^255&a:g[b]^255&a>>8,h[b]=h[b+256]=c,i[b]=i[b+256]=f[c%12]}},e.seed(0);var j=.5*(Math.sqrt(3)-1),k=(3-Math.sqrt(3))/6,l=1/3,m=1/6;e.simplex2=function(a,b){var c,d,e,f,g,l=(a+b)*j,m=Math.floor(a+l),n=Math.floor(b+l),o=(m+n)*k,p=a-m+o,q=b-n+o;p>q?(f=1,g=0):(f=0,g=1);var r=p-f+k,s=q-g+k,t=p-1+2*k,u=q-1+2*k;m&=255,n&=255;var v=i[m+h[n]],w=i[m+f+h[n+g]],x=i[m+1+h[n+1]],y=.5-p*p-q*q;0>y?c=0:(y*=y,c=y*y*v.dot2(p,q));var z=.5-r*r-s*s;0>z?d=0:(z*=z,d=z*z*w.dot2(r,s));var A=.5-t*t-u*u;return 0>A?e=0:(A*=A,e=A*A*x.dot2(t,u)),70*(c+d+e)},e.simplex3=function(a,b,c){var d,e,f,g,j,k,n,o,p,q,r=(a+b+c)*l,s=Math.floor(a+r),t=Math.floor(b+r),u=Math.floor(c+r),v=(s+t+u)*m,w=a-s+v,x=b-t+v,y=c-u+v;w>=x?x>=y?(j=1,k=0,n=0,o=1,p=1,q=0):w>=y?(j=1,k=0,n=0,o=1,p=0,q=1):(j=0,k=0,n=1,o=1,p=0,q=1):y>x?(j=0,k=0,n=1,o=0,p=1,q=1):y>w?(j=0,k=1,n=0,o=0,p=1,q=1):(j=0,k=1,n=0,o=1,p=1,q=0);var z=w-j+m,A=x-k+m,B=y-n+m,C=w-o+2*m,D=x-p+2*m,E=y-q+2*m,F=w-1+3*m,G=x-1+3*m,H=y-1+3*m;s&=255,t&=255,u&=255;var I=i[s+h[t+h[u]]],J=i[s+j+h[t+k+h[u+n]]],K=i[s+o+h[t+p+h[u+q]]],L=i[s+1+h[t+1+h[u+1]]],M=.5-w*w-x*x-y*y;0>M?d=0:(M*=M,d=M*M*I.dot3(w,x,y));var N=.5-z*z-A*A-B*B;0>N?e=0:(N*=N,e=N*N*J.dot3(z,A,B));var O=.5-C*C-D*D-E*E;0>O?f=0:(O*=O,f=O*O*K.dot3(C,D,E));var P=.5-F*F-G*G-H*H;return 0>P?g=0:(P*=P,g=P*P*L.dot3(F,G,H)),32*(d+e+f+g)},e.perlin2=function(a,b){var e=Math.floor(a),f=Math.floor(b);a-=e,b-=f,e=255&e,f=255&f;var g=i[e+h[f]].dot2(a,b),j=i[e+h[f+1]].dot2(a,b-1),k=i[e+1+h[f]].dot2(a-1,b),l=i[e+1+h[f+1]].dot2(a-1,b-1),m=c(a);return d(d(g,k,m),d(j,l,m),c(b))},e.perlin3=function(a,b,e){var f=Math.floor(a),g=Math.floor(b),j=Math.floor(e);a-=f,b-=g,e-=j,f=255&f,g=255&g,j=255&j;var k=i[f+h[g+h[j]]].dot3(a,b,e),l=i[f+h[g+h[j+1]]].dot3(a,b,e-1),m=i[f+h[g+1+h[j]]].dot3(a,b-1,e),n=i[f+h[g+1+h[j+1]]].dot3(a,b-1,e-1),o=i[f+1+h[g+h[j]]].dot3(a-1,b,e),p=i[f+1+h[g+h[j+1]]].dot3(a-1,b,e-1),q=i[f+1+h[g+1+h[j]]].dot3(a-1,b-1,e),r=i[f+1+h[g+1+h[j+1]]].dot3(a-1,b-1,e-1),s=c(a),t=c(b),u=c(e);return d(d(d(k,o,s),d(l,p,s),u),d(d(m,q,s),d(n,r,s),u),t)}}(this),function(a){a.avanor.terrain_constants={gr:{fl:{xOffset:0,yOffset:0,width:128,height:96,mapOffsetX:0,mapOffsetY:0},us:{xOffset:128,yOffset:424,width:128,height:144,mapOffsetX:-0,mapOffsetY:-24},un:{xOffset:128,yOffset:704,width:128,height:96,mapOffsetX:0,mapOffsetY:0},uw:{xOffset:0,yOffset:704,width:128,height:96,mapOffsetX:0,mapOffsetY:0},ue:{xOffset:256,yOffset:424,width:128,height:144,mapOffsetX:-0,mapOffsetY:-24},unw:{xOffset:256,yOffset:704,width:128,height:96,mapOffsetX:-0,mapOffsetY:-0},une:{xOffset:384,yOffset:704,width:128,height:96,mapOffsetX:-0,mapOffsetY:-0},use:{xOffset:128,yOffset:568,width:128,height:144,mapOffsetX:-0,mapOffsetY:-24},usw:{xOffset:0,yOffset:800,width:128,height:144,mapOffsetX:-0,mapOffsetY:-0}},re:{fl:{xOffset:0,yOffset:0,width:128,height:96,mapOffsetX:0,mapOffsetY:0},us:{xOffset:128,yOffset:424,width:128,height:144,mapOffsetX:-0,mapOffsetY:-24},un:{xOffset:128,yOffset:704,width:128,height:96,mapOffsetX:0,mapOffsetY:0},uw:{xOffset:0,yOffset:704,width:128,height:96,mapOffsetX:0,mapOffsetY:0},ue:{xOffset:256,yOffset:424,width:128,height:144,mapOffsetX:-0,mapOffsetY:-24},unw:{xOffset:256,yOffset:704,width:128,height:96,mapOffsetX:-0,mapOffsetY:-0},une:{xOffset:384,yOffset:704,width:128,height:96,mapOffsetX:-0,mapOffsetY:-0},use:{xOffset:128,yOffset:568,width:128,height:144,mapOffsetX:-0,mapOffsetY:-24},usw:{xOffset:0,yOffset:800,width:128,height:144,mapOffsetX:-0,mapOffsetY:-0}},wa:{fl:{xOffset:0,yOffset:0,width:128,height:96,mapOffsetX:0,mapOffsetY:0},mask:{wb:{xOffset:0,yOffset:482,width:128,height:96},nb:{xOffset:128,yOffset:482,width:128,height:96},eb:{xOffset:256,yOffset:482,width:128,height:96},sb:{xOffset:384,yOffset:482,width:128,height:96},ws:{xOffset:0,yOffset:578,width:128,height:96},ns:{xOffset:128,yOffset:578,width:128,height:96},es:{xOffset:256,yOffset:576,width:128,height:96},ss:{xOffset:384,yOffset:576,width:128,height:96},nwf:{xOffset:0,yOffset:864,width:128,height:96},nef:{xOffset:128,yOffset:864,width:128,height:96},swf:{xOffset:256,yOffset:864,width:128,height:96},sef:{xOffset:384,yOffset:864,width:128,height:96},nwi:{xOffset:0,yOffset:768,width:128,height:96},nei:{xOffset:128,yOffset:768,width:128,height:96},swi:{xOffset:256,yOffset:768,width:128,height:96},sei:{xOffset:384,yOffset:768,width:128,height:96}},us:{xOffset:128,yOffset:424,width:128,height:144,mapOffsetX:-0,mapOffsetY:-24},un:{xOffset:128,yOffset:704,width:128,height:96,mapOffsetX:0,mapOffsetY:0},uw:{xOffset:0,yOffset:704,width:128,height:96,mapOffsetX:0,mapOffsetY:0},ue:{xOffset:256,yOffset:424,width:128,height:144,mapOffsetX:-0,mapOffsetY:-24},unw:{xOffset:256,yOffset:704,width:128,height:96,mapOffsetX:-0,mapOffsetY:-0},une:{xOffset:384,yOffset:704,width:128,height:96,mapOffsetX:-0,mapOffsetY:-0},use:{xOffset:128,yOffset:568,width:128,height:144,mapOffsetX:-0,mapOffsetY:-24},usw:{xOffset:0,yOffset:800,width:128,height:144,mapOffsetX:-0,mapOffsetY:-0}}}}(window),function(a){a.avanor.Utils={mapCoordsToScreen:function(a,b,c,d){var e=avanor.screen.width,f=e/2-c/2+b*c/2-a*c/2,g=b*d/2+a*d/2;return{x:f,y:g}},screenCoordsToMap:function(a,b,c,d){a-=avanor.screen.width/2-c/2;var e=Math.floor((a/(c/2)+b/(d/2))/2-.5),f=Math.floor((b/(d/2)-a/(c/2))/2+.5);return{row:f,col:e}}}}(window);